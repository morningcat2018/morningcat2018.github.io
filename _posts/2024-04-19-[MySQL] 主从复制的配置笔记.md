---
layout:     post
title:      MySQL主从复制
subtitle:   配置笔记
date:       2024-04-19
author:     BY morningcat
header-img: img/201904/UNADJUSTEDNONRAW_thumb_640.jpg
catalog: true
tags:
    - MySQL
---

- 保证mysql服务均开启bin_log
- 保证mysql服务器之间,server_id不重复
- 保证mysql服务器之间,ip互通

当前MySQL版本: 8.0.23 (其他版本可查看相关版本的官方文档)

## 主库

1. 查询ip

> ifconfig

192.168.0.2

2. 是否开启bin_log

mysql -uroot -p

> show variables like "%log_bin%";

```
+---------------------------------+-----------------------------------+
| Variable_name                   | Value                             |
+---------------------------------+-----------------------------------+
| log_bin                         | ON                                |
| log_bin_basename                | /usr/local/var/mysql/binlog       |
| log_bin_index                   | /usr/local/var/mysql/binlog.index |
| log_bin_trust_function_creators | OFF                               |
| log_bin_use_v1_row_events       | OFF                               |
| sql_log_bin                     | ON                                |
+---------------------------------+-----------------------------------+
6 rows in set (0.00 sec)
```

> show master status\G;
```
*************************** 1. row ***************************
             File: binlog.000024
         Position: 156
     Binlog_Do_DB: 
 Binlog_Ignore_DB: 
Executed_Gtid_Set: 
1 row in set (0.00 sec)
```

3. 检查server_id

各个mysql服务器之间,server_id不能重复,否则复制时会报错;

> SHOW GLOBAL VARIABLES LIKE 'server_id';

```
+---------------+-------+
| Variable_name | Value |
+---------------+-------+
| server_id     | 1     |
+---------------+-------+
1 row in set (0.00 sec)
```

> SET GLOBAL server_id = 101;

4. 添加提供给从库使用的用户,用户从主库拉取数据

> CREATE USER 'sync_user'@'192.168.0.3' IDENTIFIED BY 'hello@2024';

or

> CREATE USER 'sync_user'@'%' IDENTIFIED BY 'hello@2024';

授权

> grant replication slave on *.* to 'sync_user'@'%';


## 从库

ip: 192.168.0.3  


> mysql -uroot -p

检查server_id,保证不与主库相同

执行同步命令，设置主服务器ip，同步账号密码，同步位置

> change master to master_host='192.168.0.2',master_port=3306,master_user='sync_user',master_password='hello@2024',master_log_file='binlog.000024',master_log_pos=156;

开启同步功能

> start slave;

检查同步状态

> show slave status\G;


停止同步

> STOP SLAVE;

> RESET SLAVE;


## 可参考资料

- [https://dev.mysql.com/doc/refman/8.0/en/sql-replication-statements.html](https://dev.mysql.com/doc/refman/8.0/en/sql-replication-statements.html)
- [https://dev.mysql.com/doc/refman/8.0/en/change-master-to.html](https://dev.mysql.com/doc/refman/8.0/en/change-master-to.html)


